{% extends "dashboard/base.html" %}
{% block content %}
<div class="sidebar">
    {% include "dashboard/sidebar.html" %}
</div>
<script>
    window.onload = function () {
        function generateUpdateMap(lat, lng) {
            let mymap = L.map('mapregister', {
                center: L.latLng(lat, lng),
                zoom: 5
            });
            L.tileLayer(
                'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                    maxZoom: 13,
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                    id: 'mapbox.streets'
                }).addTo(mymap);

            L.popup()
                .setLatLng(L.latLng(lat, lng))
                .setContent("Node location:\n lat: " + lat + "\n long: " + lng)
                .openOn(mymap);
        }
        var ctx = document.getElementById('radar').getContext('2d')
        var data = {
            labels: ['CRU', 'HRU', 'MRU', 'SRU'],
            datasets: [{
                    label: "reserved",
                    borderColor: "green",
                    data: [{
                        {
                            node["capacity_reserved"]["cru"]
                        }
                    }, {
                        {
                            node["capacity_reserved"]["hru"]
                        }
                    }, {
                        {
                            node["capacity_reserved"]["mru"]
                        }
                    }, {
                        {
                            node["capacity_reserved"]["sru"]
                        }
                    }]
                },
                {
                    label: "used",
                    borderColor: "blue",
                    data: [{
                        {
                            node["capacity_used"]["cru"]
                        }
                    }, {
                        {
                            node["capacity_used"]["hru"]
                        }
                    }, {
                        {
                            node["capacity_used"]["mru"]
                        }
                    }, {
                        {
                            node["capacity_used"]["sru"]
                        }
                    }]
                },
                {
                    label: "total",
                    borderColor: "black",
                    data: [{
                        {
                            node["capacity_total"]["cru"]
                        }
                    }, {
                        {
                            node["capacity_total"]["hru"]
                        }
                    }, {
                        {
                            node["capacity_total"]["mru"]
                        }
                    }, {
                        {
                            node["capacity_total"]["sru"]
                        }
                    }]
                }
            ]
        }

        var radar = new Chart(ctx, {
            type: 'radar',
            data: data
        });
        generateUpdateMap({
            {
                node["location"]["latitude"]
            }
        }, {
            {
                node["location"]["longitude"]
            }
        })
    }
</script>
<div class="page-container">
    <!-- {% include "dashboard/navbar.html" %} -->
    <div class="main-content">
        <div class="row">
            <div class="col-md-12">
                <h1>Node {{node["id"]}}</h1>
                {% if node["state"] == "OK" %}
                <h3><span class="badge badge-success"></span></h3>
                {% else %}
                <h3><span class="badge badge-danger">Down</span></h3>
                {% endif %}
                <small class="text-muted">last updated at {{node["update"]}}</small>
            </div>
        </div>
        <div class="peer peer-greed w-100p@lg+ w-100@lg- p-20">
            <div class="layers">
                <div class="layer w-100 mB-10">
                    <h6 class="lh-1">Node Location</h6>
                </div>
                <div class="layer w-100">
                    <div id="mapregister"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="card bg-light mb-3">
                    <div class="card-header">Basic Information</div>
                    <div class="card-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <td>
                                        Mac Adresses
                                    </td>
                                    <td>
                                        {{node["macaddresses"]}}
                                    </td>
                                </tr>
                            </thead>
                            <thead>
                                <tr>
                                    <td>
                                        Public ip
                                    </td>
                                    <td>
                                        {{node["node_public_ip"]}}
                                    </td>
                                </tr>
                            </thead>
                            <thead>
                                <tr>
                                    <td>
                                        Zerotier IP
                                    </td>
                                    <td>
                                        {{node["zeotier_ip"]}}
                                    </td>
                                </tr>
                            </thead>
                            <thead>
                                <tr>
                                    <td>
                                        Zerotier ID
                                    </td>
                                    <td>
                                        {{node["node_zerotier_id"]}}
                                    </td>
                                </tr>
                            </thead>
                            {% if node["noderobot"] %}
                            <thead>
                                <tr>
                                    <td>
                                        Node Robot IP
                                    </td>
                                    <td>
                                        {{node["noderobot_ipaddr"]}}
                                        <p><small>last up time {{node["noderobot_up_last"]}}
                                            </small></p>
                                    </td>
                                </tr>
                            </thead>
                            {% endif %}
                            {% if node["sysadmin"] %}
                            <thead>
                                <tr>
                                    <td>
                                        System admin IP
                                    </td>
                                    <td>
                                        {{node["sysadmin_ipaddr"]}}
                                    </td>
                                </tr>
                            </thead>
                            {% endif %}
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-light mb-3">
                    <div class="card-header">Capacity usage</div>
                    <div class="card-body" style="min-height:240px;">
                        <canvas id="radar"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{%endblock%}